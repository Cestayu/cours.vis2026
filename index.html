<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Cinema Box Office Royale</title>

<link href="https://fonts.googleapis.com/css2?family=Limelight&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --gold: #f7c873;
  --gold-shadow: rgba(247,200,115,.5);
}

body {
  margin:0;
  min-height:100vh;
  background:#000;
  color:#f5d76e;
  font-family:'Segoe UI',sans-serif;
  overflow-x:hidden;
}

body::before{
  content:"";
  position:fixed;
  inset:0;
  background:radial-gradient(circle,rgba(0,0,0,.6),#000);
  z-index:-1;
}

h1{
  font-family:'Limelight',cursive;
  font-size:clamp(48px,10vw,96px);
  letter-spacing:8px;
  margin:40px 0;
  text-align:center;
  color:var(--gold);
  text-shadow:0 0 20px var(--gold-shadow);
}

#boxoffice-viz{
  width:90%;
  max-width:1100px;
  margin:auto;
  padding:40px;
  background:rgba(0,0,0,.85);
  border-radius:20px;
  box-shadow:0 20px 50px rgba(0,0,0,.6);
}

.controls{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:30px;
  margin-bottom:30px;
}

@media(max-width:768px){
  .controls{grid-template-columns:1fr}
}

.year-display{
  font-family:'Limelight',cursive;
  font-size:52px;
  color:var(--gold);
}

input[type=range]{width:100%;accent-color:var(--gold)}

#search-bar{
  padding:12px 20px;
  border-radius:30px;
  border:1px solid var(--gold);
  background:rgba(255,255,255,.05);
  color:white;
  font-size:16px;
}

#open-chart{
  grid-column:1/-1;
  padding:14px;
  border-radius:30px;
  border:1px solid var(--gold);
  background:rgba(247,200,115,.15);
  color:var(--gold);
  font-size:16px;
  cursor:pointer;
}

#open-chart:hover{
  box-shadow:0 0 20px var(--gold-shadow);
}

.films-panel{display:grid;gap:20px}

.film{
  display:flex;
  gap:20px;
  padding:15px;
  border-radius:14px;
  border:1px solid rgba(247,200,115,.2);
  background:rgba(255,255,255,.04);
  cursor:pointer;
  transition:.4s;
}

.film:hover{transform:scale(1.02)}

.film.expanded{
  background:rgba(247,200,115,.12);
  box-shadow:0 0 25px rgba(247,200,115,.4);
}

.poster{
  width:100px;
  height:150px;
  background-size:cover;
  background-position:center;
  border-radius:8px;
}

.film-title{
  font-family:'Limelight';
  font-size:24px;
  color:var(--gold);
}

.meta-grid{display:flex;flex-wrap:wrap;gap:10px;font-size:14px}

.tag{
  padding:4px 10px;
  border-radius:4px;
  background:rgba(247,200,115,.15);
}

.box-office-amount{
  margin-top:8px;
  font-size:18px;
  font-weight:bold;
}

.film-details{
  max-height:0;
  overflow:hidden;
  opacity:0;
  transition:.5s;
  margin-top:10px;
}

.film.expanded .film-details{
  max-height:200px;
  opacity:1;
}

#chart-section{
  width:90%;
  max-width:1100px;
  margin:80px auto;
  padding:40px;
  background:rgba(0,0,0,.9);
  border-radius:20px;
  display:none;
}
</style>
</head>

<body>

<h1>Cinema</h1>

<section id="boxoffice-viz">
  <div class="controls">
    <div>
      <div class="year-display" id="boxoffice-year">2013</div>
      <input type="range" min="2013" max="2023" value="2013" id="boxoffice-slider">
    </div>
    <input type="text" id="search-bar" placeholder="Rechercher un film, genre, r√©alisateur">
    <button id="open-chart">üìä Lecture globale du march√©</button>
  </div>

  <div class="films-panel" id="boxoffice-films"></div>
</section>

<section id="chart-section">
  <canvas id="boxofficeChart"></canvas>
</section>

<script>
/* ========= DONN√âES ========= */
const enrichedData = [...document.currentScript.ownerDocument.querySelectorAll('script')][0]; // ‚ö† hack supprim√© ci-dessous
</script>

<script>
/* ‚ö†Ô∏è COLLAGE DIRECT DES DONN√âES */
const enrichedData = ${JSON.stringify([])};
</script>

<script>
/* ========= LOGIQUE ========= */
const slider=document.getElementById("boxoffice-slider");
const yearDisplay=document.getElementById("boxoffice-year");
const panel=document.getElementById("boxoffice-films");
const search=document.getElementById("search-bar");

function money(v){
  return new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',maximumFractionDigits:0}).format(v);
}

function update(){
  const y=+slider.value;
  const t=search.value.toLowerCase();
  yearDisplay.textContent=y;
  panel.innerHTML="";

  enrichedData.filter(d=>d.year===y && (
    d.title.toLowerCase().includes(t) ||
    d.genre.toLowerCase().includes(t) ||
    d.director.toLowerCase().includes(t)
  )).forEach(f=>{
    const el=document.createElement("div");
    el.className="film";
    el.innerHTML=`
      <div class="poster" style="background-image:url('${f.poster}')"></div>
      <div>
        <div class="film-title">#${f.rank} ${f.title}</div>
        <div class="meta-grid">
          <span class="tag">${f.genre}</span>
          <span class="tag">üé¨ ${f.director}</span>
          <span class="tag">üåç ${f.country}</span>
        </div>
        <div class="box-office-amount">${money(f.boxOffice)}</div>
        <div class="film-details">
          <div>üìÖ Ann√©e : ${f.year}</div>
          <div>üë§ R√©alisation : ${f.directorGender}</div>
          <div>üèÜ Rang mondial : ${f.rank}</div>
        </div>
      </div>`;
    el.onclick=()=>el.classList.toggle("expanded");
    panel.appendChild(el);
  });
}

slider.oninput=update;
search.oninput=update;

/* ========= GRAPHIQUE ========= */
document.getElementById("open-chart").onclick=()=>{
  document.getElementById("chart-section").style.display="block";

  const top1=enrichedData.filter(d=>d.rank===1).sort((a,b)=>a.year-b.year);

  new Chart(document.getElementById("boxofficeChart"),{
    type:"line",
    data:{
      labels:top1.map(d=>d.year),
      datasets:[{
        label:"Film n¬∞1 mondial",
        data:top1.map(d=>d.boxOffice),
        fill:true,
        tension:.4,
        borderColor:"#f7c873",
        backgroundColor:top1.map(d=>
          (d.year===2020||d.year===2021)
          ?"rgba(255,80,80,.3)"
          :"rgba(247,200,115,.3)"
        )
      }]
    },
    options:{
      scales:{
        y:{ticks:{callback:v=>v/1e9+"B $"}}
      }
    }
  });
};

update();
</script>

</body>
</html>
