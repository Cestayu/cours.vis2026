<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cinema | Premium Box Office Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Limelight&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      background: radial-gradient(circle at center, #111 0%, #000 70%);
      color: #f5d76e;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden;
      padding-bottom: 60px;
    }

    /* --- Lamps (Visual Identity) --- */
    .lamp {
      position: absolute; top: 40px; width: 40px; height: 40px;
      background: radial-gradient(circle, #ffd27d 0%, #ff9f1c 40%, #cc6b00 70%);
      border-radius: 50%;
      box-shadow: 0 0 30px rgba(255, 160, 60, 0.9), 0 0 80px rgba(255, 120, 0.6);
      z-index: 1;
    }
    .lamp.left { left: 80px; } .lamp.right { right: 80px; }

    h1 {
      margin-top: 60px;
      font-family: 'Limelight', cursive;
      font-size: 80px;
      text-transform: uppercase;
      color: #f7c873;
      text-shadow: 0 0 10px rgba(255, 180, 80, 0.6);
      z-index: 2;
    }

    /* --- Research / Search Section --- */
    .research-panel {
      width: 90%; max-width: 1000px;
      display: flex; gap: 15px; margin-bottom: 30px;
      background: rgba(255, 215, 120, 0.05);
      padding: 20px; border-radius: 15px;
      border: 1px solid rgba(255, 215, 120, 0.2);
    }
    .research-panel input, .research-panel select {
      flex: 1; padding: 10px; border-radius: 5px;
      background: #000; color: #f7c873; border: 1px solid #f7c873;
    }

    /* --- Main Viz --- */
    #boxoffice-viz, #trends-viz {
      width: 90%; max-width: 1000px;
      background: rgba(0,0,0,0.6);
      border: 1px solid rgba(255, 215, 120, 0.3);
      border-radius: 20px; padding: 30px; margin-top: 20px;
    }

    .slider-container { text-align: center; margin-bottom: 25px; }
    .year-display { font-size: 54px; font-family: 'Limelight'; color: #f7c873; }
    
    .btn-play {
      background: #f7c873; color: #000; border: none; padding: 10px 20px;
      border-radius: 20px; font-weight: bold; cursor: pointer; margin-bottom: 15px;
    }

    /* --- Film Cards --- */
    .films-panel { display: grid; grid-template-columns: 1fr; gap: 15px; }
    .film {
      display: flex; align-items: center; padding: 12px;
      border: 1px solid rgba(255, 215, 120, 0.25);
      border-radius: 14px; background: rgba(0,0,0,0.5);
      position: relative; overflow: hidden;
    }
    .poster { width: 100px; height: 140px; border-radius: 10px; margin-right: 20px; background-size: cover; }
    .film-title { font-size: 22px; font-weight: bold; color: #f7c873; }

    .hover-details {
      position: absolute; right: 10px; top: 10px; bottom: 10px;
      background: rgba(0,0,0,0.9); padding: 15px; border-radius: 10px;
      border: 1px solid #f7c873; display: none; width: 250px;
    }
    .film:hover .hover-details { display: block; }

    /* --- Trends Section --- */
    .trends-grid { display: grid; grid-template-columns: 1fr 250px; gap: 20px; align-items: center; }
    .spotlight-mini { text-align: center; border-left: 1px solid rgba(255,215,120,0.3); padding-left: 20px; }
    .covid-note { color: #ff6b6b; font-weight: bold; font-size: 13px; margin-top: 10px; display: none; }
  </style>
</head>
<body>

  <div class="lamp left"></div>
  <div class="lamp right"></div>

  <h1>Cinema</h1>

  <div class="research-panel">
    <select id="res-genre">
      <option value="All">All Genres</option>
      <option value="Animation">Animation</option>
      <option value="Action">Action</option>
      <option value="Science-fiction">Science-fiction</option>
      <option value="Fantasy">Fantasy</option>
    </select>
    <input type="text" id="res-director" placeholder="Filter by Director...">
    <input type="text" id="res-title" placeholder="Search Title...">
  </div>

  <section id="boxoffice-viz">
    <div class="slider-container">
      <button class="btn-play" id="play-btn">▶ Play Evolution</button>
      <div class="year-display" id="boxoffice-year">2013</div>
      <input type="range" min="2013" max="2023" step="1" value="2013" id="boxoffice-slider" style="width: 80%;">
    </div>
    <div class="films-panel" id="boxoffice-films"></div>
  </section>

  <section id="trends-viz">
    <h2 style="font-family: 'Limelight'; text-align: center;">Yearly Trends Evolution</h2>
    <div class="trends-grid">
      <canvas id="trendChart"></canvas>
      <div class="spotlight-mini">
        <div style="font-size: 11px; opacity: 0.6;">#1 MOVIE THIS YEAR</div>
        <img id="trend-poster" style="width: 120px; border-radius: 5px; margin: 10px 0; border: 1px solid #f7c873;">
        <div id="trend-title" style="font-weight: bold; font-size: 14px;">Title</div>
        <div id="covid-alert" class="covid-note">⚠️ COVID-19 IMPACT</div>
      </div>
    </div>
  </section>

  <script>
    const enrichedData = [
      {"year":2013,"rank":1,"title":"Frozen","boxOffice":"1280802282","genre":"Animation","country":"États-Unis","director":"Chris Buck, Jennifer Lee","directorGender":"Homme / Femme","poster":"https://image.tmdb.org/t/p/w500/kgwjIb1CkFCftymFGOtdLlOrWYv.jpg"},
      {"year":2013,"rank":2,"title":"Iron Man 3","boxOffice":"1214811252","genre":"Action / Super-héros","country":"États-Unis","director":"Shane Black","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/qhPtAc1TKbMPqNvcdXSOn9Bn7hZ.jpg"},
      {"year":2013,"rank":3,"title":"Despicable Me 2","boxOffice":"970766005","genre":"Animation","country":"États-Unis","director":"Pierre Coffin, Chris Renaud","directorGender":"Hommes","poster":"https://image.tmdb.org/t/p/w500/5Fh4NdoEnCjCK9wLjdJ9DJNFl2b.jpg"},
      {"year":2013,"rank":4,"title":"The Hobbit: The Desolation of Smaug","boxOffice":"958366855","genre":"Fantasy","country":"Nouvelle-Zélande / États-Unis","director":"Peter Jackson","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/xQYiXsmeYkKMq5yvwD0ejl8cWs7.jpg"},
      {"year":2013,"rank":5,"title":"The Hunger Games: Catching Fire","boxOffice":"865011746","genre":"Science-fiction","country":"États-Unis","director":"Francis Lawrence","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/v9qVkyS58WHdfrcEq0dxUJFKS9n.jpg"},
      {"year":2014,"rank":1,"title":"Transformers: Age of Extinction","boxOffice":"1104054072","genre":"Action / Science-fiction","country":"États-Unis","director":"Michael Bay","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/jyzrfx2WaeY60kYZpPYepSjGz4S.jpg"},
      {"year":2014,"rank":2,"title":"The Hobbit: The Battle of the Five Armies","boxOffice":"962201338","genre":"Fantasy","country":"Nouvelle-Zélande / États-Unis","director":"Peter Jackson","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/9zd9P2J3N7A4hBgx1RGCFgTMBPk.jpg"},
      {"year":2014,"rank":3,"title":"Guardians of the Galaxy","boxOffice":"773350147","genre":"Action / Science-fiction","country":"États-Unis","director":"James Gunn","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/r7vmZjiyZw9rpJMQJdXpjgiCOk9.jpg"},
      {"year":2014,"rank":4,"title":"Maleficent","boxOffice":"758536735","genre":"Fantasy","country":"États-Unis","director":"Robert Stromberg","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/bDG3yei6AJlEAK3A5wN7RwFXQ7V.jpg"},
      {"year":2014,"rank":5,"title":"The Hunger Games: Mockingjay – Part 1","boxOffice":"755356711","genre":"Science-fiction","country":"États-Unis","director":"Francis Lawrence","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/4PwyB0ErucIANzW24Kori71J6gU.jpg"},
      {"year":2015,"rank":1,"title":"Star Wars: The Force Awakens","boxOffice":"2068223624","genre":"Science-fiction","country":"États-Unis","director":"J. J. Abrams","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/wqnLdwVXoBjKibFRR5U3y0aDUhs.jpg"},
      {"year":2015,"rank":2,"title":"Jurassic World","boxOffice":"1671537444","genre":"Science-fiction","country":"États-Unis","director":"Colin Trevorrow","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/jIlQHSUc1NnqhbWtkkdIrYLiNl7.jpg"},
      {"year":2015,"rank":3,"title":"Furious 7","boxOffice":"1515341399","genre":"Action","country":"États-Unis","director":"James Wan","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/dCgm7efXDmiABSdWDHBDBx2jwmn.jpg"},
      {"year":2015,"rank":4,"title":"Avengers: Age of Ultron","boxOffice":"1402809540","genre":"Action / Super-héros","country":"États-Unis","director":"Joss Whedon","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/4ssDuvEDkSArWEdyBl2X5EHvYKU.jpg"},
      {"year":2015,"rank":5,"title":"Minions","boxOffice":"1159444662","genre":"Animation","country":"États-Unis","director":"Pierre Coffin, Kyle Balda","directorGender":"Hommes","poster":"https://image.tmdb.org/t/p/w500/dr02BdCNAUPVU07aOodwPYv6HCf.jpg"},
      {"year":2016,"rank":1,"title":"Captain America: Civil War","boxOffice":"1153337496","genre":"Action / Super-héros","country":"États-Unis","director":"Anthony & Joe Russo","directorGender":"Hommes","poster":"https://image.tmdb.org/t/p/w500/rAGiXaUfPu0D2BJ1JMQzJiD8tFl.jpg"},
      {"year":2016,"rank":2,"title":"Rogue One: A Star Wars Story","boxOffice":"1056057273","genre":"Science-fiction","country":"États-Unis","director":"Gareth Edwards","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/i0yw1mFbB7sNGHCs7EXZPzFkdA1.jpg"},
      {"year":2016,"rank":3,"title":"Finding Dory","boxOffice":"1028570889","genre":"Animation","country":"États-Unis","director":"Andrew Stanton","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/yFjVlsJmEMacU0BNUwdGZlo2ixq.jpg"},
      {"year":2016,"rank":4,"title":"Zootopia","boxOffice":"1025521689","genre":"Animation","country":"États-Unis","director":"Byron Howard, Rich Moore","directorGender":"Hommes","poster":"https://image.tmdb.org/t/p/w500/hlK0e0wAQ3VLuJcsfIYPvb4JVud.jpg"},
      {"year":2016,"rank":5,"title":"The Jungle Book","boxOffice":"967724775","genre":"Aventure / Fantasy","country":"États-Unis","director":"Jon Favreau","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/vOipe2myi26UDwP978hsYOrnUWC.jpg"},
      {"year":2017,"rank":1,"title":"Star Wars: The Last Jedi","boxOffice":"1334407706","genre":"Science-fiction","country":"États-Unis","director":"Rian Johnson","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/kOVEVeg59E0wsnXmF9nrh6OmWII.jpg"},
      {"year":2017,"rank":2,"title":"Beauty and the Beast","boxOffice":"1266115964","genre":"Fantasy","country":"États-Unis","director":"Bill Condon","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/hKegSKIDep2ewJWPUQD7u0KqFIp.jpg"},
      {"year":2017,"rank":3,"title":"The Fate of the Furious","boxOffice":"1236005118","genre":"Action","country":"États-Unis","director":"F. Gary Gray","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/dImWM7GJqryWJO9LHa3XQ8DD5NH.jpg"},
      {"year":2017,"rank":4,"title":"Despicable Me 3","boxOffice":"1034800131","genre":"Animation","country":"États-Unis","director":"Kyle Balda","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/6t3YWl7hrr88lCEFlGVqW5yV99R.jpg"},
      {"year":2017,"rank":5,"title":"Jumanji: Welcome to the Jungle","boxOffice":"962102237","genre":"Aventure","country":"États-Unis","director":"Jake Kasdan","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/bXrZ5iHBEjH7WMidbUDQ0U2xbmr.jpg"},
      {"year":2018,"rank":1,"title":"Avengers: Infinity War","boxOffice":"2048359754","genre":"Action / Super-héros","country":"États-Unis","director":"Anthony & Joe Russo","directorGender":"Hommes","poster":"https://image.tmdb.org/t/p/w500/7WsyChQLEftFiDOVTGkv3hFpyyt.jpg"},
      {"year":2018,"rank":2,"title":"Black Panther","boxOffice":"1347597973","genre":"Action / Super-héros","country":"États-Unis","director":"Ryan Coogler","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/uxzzxijgPIY7slzFvMotPv8wjKA.jpg"},
      {"year":2018,"rank":3,"title":"Jurassic World: Fallen Kingdom","boxOffice":"1308467944","genre":"Science-fiction","country":"États-Unis","director":"J. A. Bayona","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/c9XxwwhPHdaImA2f1WEfEsbhaFB.jpg"},
      {"year":2018,"rank":4,"title":"Incredibles 2","boxOffice":"1242805359","genre":"Animation","country":"États-Unis","director":"Brad Bird","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/9lFKBtaVIhP7E2Pk0IY1CwTKTMZ.jpg"},
      {"year":2018,"rank":5,"title":"Aquaman","boxOffice":"1148528393","genre":"Action / Super-héros","country":"États-Unis","director":"James Wan","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/5Kg76ldv7VxeX9YlcQXiowHgdX6.jpg"},
      {"year":2019,"rank":1,"title":"Avengers: Endgame","boxOffice":"2797501328","genre":"Action / Super-héros","country":"États-Unis","director":"Anthony & Joe Russo","directorGender":"Hommes","poster":"https://image.tmdb.org/t/p/w500/or06FN3Dka5tukK1e9sl16pB3iy.jpg"},
      {"year":2019,"rank":2,"title":"The Lion King","boxOffice":"1656943394","genre":"Animation","country":"États-Unis","director":"Jon Favreau","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/dzBtMocZuJbjLOXvrl4zGYigDzh.jpg"},
      {"year":2019,"rank":3,"title":"Frozen II","boxOffice":"1450026933","genre":"Animation","country":"États-Unis","director":"Chris Buck, Jennifer Lee","directorGender":"Homme / Femme","poster":"https://image.tmdb.org/t/p/w500/xJWPZIYOEFIjZpBL7SVBGnzRYXp.jpg"},
      {"year":2019,"rank":4,"title":"Spider-Man: Far From Home","boxOffice":"1131927996","genre":"Action / Super-héros","country":"États-Unis","director":"Jon Watts","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/4q2NNj4S5dG2RLF9CpXsej7yXl.jpg"},
      {"year":2019,"rank":5,"title":"Captain Marvel","boxOffice":"1128462972","genre":"Action / Super-héros","country":"États-Unis","director":"Anna Boden, Ryan Fleck","directorGender":"Femme / Homme","poster":"https://image.tmdb.org/t/p/w500/AtsgWhDnHTq68L0lLsUrCnM7TjG.jpg"},
      {"year":2020,"rank":1,"title":"The Eight Hundred","boxOffice":"461421559","genre":"Guerre","country":"Chine","director":"Guan Hu","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/pk4GFAALvJhckzPY5h3L1RkfSD6.jpg"},
      {"year":2020,"rank":2,"title":"Bad Boys for Life","boxOffice":"426505244","genre":"Action","country":"États-Unis","director":"Adil El Arbi, Bilall Fallah","directorGender":"Hommes","poster":"https://image.tmdb.org/t/p/w500/y95lQLnuNKdPAzw9F9Ab8kJ80c3.jpg"},
      {"year":2020,"rank":3,"title":"My People, My Homeland","boxOffice":"422390820","genre":"Comédie","country":"Chine","director":"Collectif","directorGender":"Hommes","poster":"https://image.tmdb.org/t/p/w500/A68gGiKxr2OfQRSztVmnn8dUVjy.jpg"},
      {"year":2020,"rank":4,"title":"Tenet","boxOffice":"365304105","genre":"Science-fiction","country":"États-Unis","director":"Christopher Nolan","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/k68nPLbIST6NP96JmTxmZijEvCA.jpg"},
      {"year":2020,"rank":5,"title":"Sonic the Hedgehog","boxOffice":"319715683","genre":"Aventure","country":"États-Unis","director":"Jeff Fowler","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/aQvJ5WPzZgYVDrxLX4R6cLJCEaQ.jpg"},
      {"year":2021,"rank":1,"title":"Spider-Man: No Way Home","boxOffice":"1921847111","genre":"Action / Super-héros","country":"États-Unis","director":"Jon Watts","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/1g0dhYtq4irTY1GPXvft6k4YLjm.jpg"},
      {"year":2021,"rank":2,"title":"The Battle at Lake Changjin","boxOffice":"902548476","genre":"Guerre","country":"Chine","director":"Chen Kaige","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/9Ehh32tx0IJM7RKIFMsTDPJUfZK.jpg"},
      {"year":2021,"rank":3,"title":"Hi, Mom","boxOffice":"841674419","genre":"Comédie dramatique","country":"Chine","director":"Jia Ling","directorGender":"Femme","poster":"https://image.tmdb.org/t/p/w500/aN8vJdg3FG0KNBtt7mkFGELi1w6.jpg"},
      {"year":2021,"rank":4,"title":"No Time to Die","boxOffice":"774153007","genre":"Action","country":"Royaume-Uni / États-Unis","director":"Cary Joji Fukunaga","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/iUgygt3fscRoKWCV1d0C7FbM9TP.jpg"},
      {"year":2021,"rank":5,"title":"F9","boxOffice":"726229501","genre":"Action","country":"États-Unis","director":"Justin Lin","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/bOFaAXmWWXC3Rbv4u4uM9ZSzRXP.jpg"},
      {"year":2022,"rank":1,"title":"Avatar: The Way of Water","boxOffice":"2320250281","genre":"Science-fiction","country":"États-Unis","director":"James Cameron","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/t6HIqrRAclMCA60NsSmeqe9RmNV.jpg"},
      {"year":2022,"rank":2,"title":"Top Gun: Maverick","boxOffice":"1495696292","genre":"Action","country":"États-Unis","director":"Joseph Kosinski","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/62HCnUTziyWcpDaBO2i1DX17ljH.jpg"},
      {"year":2022,"rank":3,"title":"Jurassic World Dominion","boxOffice":"1001978080","genre":"Science-fiction","country":"États-Unis","director":"Colin Trevorrow","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/kAVRgw7GgK1CfYEJq8ME6EvRIgU.jpg"},
      {"year":2022,"rank":4,"title":"Doctor Strange in the Multiverse of Madness","boxOffice":"955775804","genre":"Action / Super-héros","country":"États-Unis","director":"Sam Raimi","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/9Gtg2DzBhmYamXBS1hKAhiwbBKS.jpg"},
      {"year":2022,"rank":5,"title":"Minions: The Rise of Gru","boxOffice":"940203765","genre":"Animation","country":"États-Unis","director":"Kyle Balda","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/wKiOkZTN9lUUUNZLmtnwubZYONg.jpg"},
      {"year":2023,"rank":1,"title":"Barbie","boxOffice":"1445638421","genre":"Comédie / Fantasy","country":"États-Unis","director":"Greta Gerwig","directorGender":"Femme","poster":"https://image.tmdb.org/t/p/w500/iuFNMS8U5cb6xfzi51Dbkovj7vM.jpg"},
      {"year":2023,"rank":2,"title":"The Super Mario Bros. Movie","boxOffice":"1361992475","genre":"Animation","country":"États-Unis","director":"Aaron Horvath, Michael Jelenic","directorGender":"Hommes","poster":"https://image.tmdb.org/t/p/w500/qNBAXBIQlnOThrVvA6mA2B5ggV6.jpg"},
      {"year":2023,"rank":3,"title":"Oppenheimer","boxOffice":"975440031","genre":"Drame historique","country":"États-Unis","director":"Christopher Nolan","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/8Gxv8gSFCU0XGDykEGv7zR1n2ua.jpg"},
      {"year":2023,"rank":4,"title":"Guardians of the Galaxy Vol. 3","boxOffice":"845555777","genre":"Action / Super-héros","country":"États-Unis","director":"James Gunn","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/r2J02Z2OpNTctfOSN1Ydgii51I3.jpg"},
      {"year":2023,"rank":5,"title":"Fast X","boxOffice":"704875015","genre":"Action","country":"États-Unis","director":"Louis Leterrier","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/fiVW06jE7z9YnO4trhaMEdclSiC.jpg"}
    ];

    const slider = document.getElementById("boxoffice-slider");
    const yearLabel = document.getElementById("boxoffice-year");
    const panel = document.getElementById("boxoffice-films");
    const playBtn = document.getElementById("play-btn");

    let chart;

    function update() {
      const year = slider.value;
      const genre = document.getElementById("res-genre").value;
      const director = document.getElementById("res-director").value.toLowerCase();
      const title = document.getElementById("res-title").value.toLowerCase();

      yearLabel.textContent = year;
      panel.innerHTML = "";

      const films = enrichedData.filter(d => {
        return d.year == year && 
               (genre === "All" || d.genre.includes(genre)) &&
               d.director.toLowerCase().includes(director) &&
               d.title.toLowerCase().includes(title);
      });

      films.forEach(f => {
        panel.innerHTML += `
          <div class="film">
            <div class="poster" style="background-image:url('${f.poster}')"></div>
            <div class="info">
              <div class="film-title">#${f.rank} ${f.title}</div>
              <div style="opacity:0.7">${f.genre} | ${f.director}</div>
            </div>
            <div class="hover-details">
              <div><b>Country:</b> ${f.country}</div>
              <div><b>Revenue:</b> $${parseInt(f.boxOffice).toLocaleString()}</div>
              <div><b>Director Gender:</b> ${f.directorGender}</div>
            </div>
          </div>
        `;
      });

      // Update Trend Spotlight (always show year #1 regardless of filters)
      const top1 = enrichedData.find(d => d.year == year && d.rank == 1);
      document.getElementById("trend-poster").src = top1.poster;
      document.getElementById("trend-title").textContent = top1.title;
      document.getElementById("covid-alert").style.display = (year == 2020) ? "block" : "none";
    }

    // Animation Logic
    let playing = false;
    let timer;
    playBtn.onclick = () => {
      playing = !playing;
      playBtn.textContent = playing ? "⏸ Pause" : "▶ Play Evolution";
      if(playing) {
        timer = setInterval(() => {
          slider.value = (parseInt(slider.value) >= 2023) ? 2013 : parseInt(slider.value) + 1;
          update();
        }, 1500);
      } else clearInterval(timer);
    };

    // Chart.js Init
    function initChart() {
      const years = [...new Set(enrichedData.map(d => d.year))].sort();
      const totals = years.map(y => enrichedData.filter(d => d.year === y).reduce((a,b) => a + parseInt(b.boxOffice), 0) / 1e9);

      chart = new Chart(document.getElementById('trendChart'), {
        type: 'line',
        data: {
          labels: years,
          datasets: [{
            label: 'Top 5 Revenue (Billions)',
            data: totals,
            borderColor: '#f7c873',
            tension: 0.4,
            fill: true,
            backgroundColor: 'rgba(247, 200, 115, 0.1)'
          }]
        },
        options: {
          scales: {
            y: { ticks: { color: '#f7c873' } },
            x: { ticks: { color: '#f7c873' } }
          },
          plugins: { legend: { display: false } }
        }
      });
    }

    [slider, document.getElementById("res-genre"), document.getElementById("res-director"), document.getElementById("res-title")].forEach(el => el.oninput = update);

    initChart();
    update();
  </script>
</body>
</html>
