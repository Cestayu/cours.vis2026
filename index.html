<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Cinema - Box Office Analytics</title>
  <link href="https://fonts.googleapis.com/css2?family=Limelight&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  
  <style>
    :root {
      --gold: #f7c873;
      --dark-gold: #cc6b00;
      --bg-dark: #111;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at center, #111 0%, #000 70%);
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--gold);
      overflow-x: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    h1 {
      margin-top: 40px;
      font-family: 'Limelight', cursive;
      font-size: 72px;
      letter-spacing: 8px;
      text-transform: uppercase;
      color: var(--gold);
      text-shadow: 0 0 10px rgba(255, 180, 80, 0.6), 0 0 25px rgba(255, 140, 0.5);
      z-index: 2;
    }

    /* --- Barre de recherche --- */
    .search-section {
      width: 90%;
      max-width: 1000px;
      margin: 20px 0;
      z-index: 5;
    }

    .search-input {
      width: 100%;
      padding: 15px 25px;
      border-radius: 30px;
      border: 1px solid var(--gold);
      background: rgba(0,0,0,0.7);
      color: var(--gold);
      font-size: 18px;
      outline: none;
      transition: box-shadow 0.3s;
    }

    .search-input:focus {
      box-shadow: 0 0 15px var(--dark-gold);
    }

    /* --- Graphique & Analyse --- */
    #analytics-container {
      width: 90%;
      max-width: 1000px;
      background: rgba(0,0,0,0.8);
      border: 1px solid rgba(255, 215, 120, 0.3);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .controls-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .btn-export {
      background: var(--gold);
      color: #000;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: transform 0.2s;
    }

    .btn-export:hover {
      transform: scale(1.05);
      background: #fff;
    }

    /* --- Structure existante modifiée --- */
    #boxoffice-viz {
      width: 90%;
      max-width: 1000px;
      background: rgba(0,0,0,0.6);
      border: 1px solid rgba(255, 215, 120, 0.3);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 50px;
    }

    .slider-container { text-align: center; margin-bottom: 20px; }
    .year-display { font-size: 44px; font-weight: bold; font-family: 'Limelight'; }
    
    input[type=range] {
      width: 100%;
      accent-color: var(--gold);
      cursor: pointer;
    }

    .films-panel {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
    }

    .film {
      display: flex;
      align-items: center;
      padding: 12px;
      border: 1px solid rgba(255, 215, 120, 0.2);
      border-radius: 14px;
      background: rgba(20,20,20,0.8);
      transition: transform 0.3s, border-color 0.3s;
      position: relative;
    }

    .film:hover {
      transform: translateX(10px);
      border-color: var(--gold);
    }

    .poster {
      width: 90px;
      height: 130px;
      border-radius: 8px;
      margin-right: 20px;
      background-size: cover;
      background-position: center;
      background-color: #222;
      flex-shrink: 0;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }

    .info .film-title { font-size: 20px; color: var(--gold); margin-bottom: 5px; }
    .info .meta { font-size: 14px; color: #aaa; }

    .hover-details {
      position: absolute;
      right: 20px;
      background: rgba(0,0,0,0.9);
      padding: 15px;
      border: 1px solid var(--gold);
      border-radius: 10px;
      display: none;
      z-index: 10;
    }

    .film:hover .hover-details { display: block; }

    .lamp {
      position: absolute; top: 20px; width: 30px; height: 30px;
      background: radial-gradient(circle, #ffd27d 0%, #ff9f1c 70%);
      border-radius: 50%;
      box-shadow: 0 0 50px rgba(255, 160, 60, 0.8);
    }
    .lamp.left { left: 5%; }
    .lamp.right { right: 5%; }
  </style>
</head>
<body>

  <div class="lamp left"></div>
  <div class="lamp right"></div>
  
  <h1>Cinema</h1>

  <div class="search-section">
    <input type="text" id="movie-search" class="search-input" placeholder="Rechercher un film, un réalisateur, un genre...">
  </div>

  <section id="analytics-container">
    <div class="controls-row">
      <h3 style="font-family: 'Limelight'; margin: 0;">Évolution du N°1 Mondial</h3>
      <button class="btn-export" onclick="exportPDF()">Exporter Analyse (PDF)</button>
    </div>
    <canvas id="topChart" height="100"></canvas>
  </section>

  <section id="boxoffice-viz">
    <div class="slider-container">
      <div class="year-display" id="boxoffice-year">2013</div>
      <input type="range" min="2013" max="2023" step="1" value="2023" id="boxoffice-slider">
    </div>

    <div class="films-panel" id="boxoffice-films"></div>
  </section>

<script>
  (function () {
    const data = [
      {"year":2013,"rank":1,"title":"Frozen","boxOffice":1280802282,"genre":"Animation","country":"États-Unis","director":"Chris Buck, Jennifer Lee","directorGender":"Homme / Femme","poster":"https://image.tmdb.org/t/p/w500/kgwjIb1CkFCftymFGOtdLlOrWYv.jpg"},
      {"year":2013,"rank":2,"title":"Iron Man 3","boxOffice":1214811252,"genre":"Action / Super-héros","country":"États-Unis","director":"Shane Black","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/qhPtAc1TKbMPqNvcdXSOn9Bn7hZ.jpg"},
      {"year":2013,"rank":3,"title":"Despicable Me 2","boxOffice":970766005,"genre":"Animation","country":"États-Unis","director":"Pierre Coffin, Chris Renaud","directorGender":"Hommes","poster":"https://image.tmdb.org/t/p/w500/5Fh4NdoEnCjCK9wLjdJ9DJNFl2b.jpg"},
      {"year":2013,"rank":4,"title":"The Hobbit: The Desolation of Smaug","boxOffice":958366855,"genre":"Fantasy","country":"Nouvelle-Zélande / États-Unis","director":"Peter Jackson","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/xQYiXsmeYkKMq5yvwD0ejl8cWs7.jpg"},
      {"year":2013,"rank":5,"title":"The Hunger Games: Catching Fire","boxOffice":865011746,"genre":"Science-fiction","country":"États-Unis","director":"Francis Lawrence","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/v9qVkyS58WHdfrcEq0dxUJFKS9n.jpg"},
      {"year":2014,"rank":1,"title":"Transformers: Age of Extinction","boxOffice":1104054072,"genre":"Action / Science-fiction","country":"États-Unis","director":"Michael Bay","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/jyzrfx2WaeY60kYZpPYepSjGz4S.jpg"},
      {"year":2014,"rank":2,"title":"The Hobbit: The Battle of the Five Armies","boxOffice":962201338,"genre":"Fantasy","country":"Nouvelle-Zélande / États-Unis","director":"Peter Jackson","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/9zd9P2J3N7A4hBgx1RGCFgTMBPk.jpg"},
      {"year":2014,"rank":3,"title":"Guardians of the Galaxy","boxOffice":773350147,"genre":"Action / Science-fiction","country":"États-Unis","director":"James Gunn","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/r7vmZjiyZw9rpJMQJdXpjgiCOk9.jpg"},
      {"year":2014,"rank":4,"title":"Maleficent","boxOffice":758536735,"genre":"Fantasy","country":"États-Unis","director":"Robert Stromberg","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/bDG3yei6AJlEAK3A5wN7RwFXQ7V.jpg"},
      {"year":2014,"rank":5,"title":"The Hunger Games: Mockingjay – Part 1","boxOffice":755356711,"genre":"Science-fiction","country":"États-Unis","director":"Francis Lawrence","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/4PwyB0ErucIANzW24Kori71J6gU.jpg"},
      {"year":2015,"rank":1,"title":"Star Wars: The Force Awakens","boxOffice":2068223624,"genre":"Science-fiction","country":"États-Unis","director":"J. J. Abrams","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/wqnLdwVXoBjKibFRR5U3y0aDUhs.jpg"},
      {"year":2015,"rank":2,"title":"Jurassic World","boxOffice":1671537444,"genre":"Science-fiction","country":"États-Unis","director":"Colin Trevorrow","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/jIlQHSUc1NnqhbWtkkdIrYLiNl7.jpg"},
      {"year":2015,"rank":3,"title":"Furious 7","boxOffice":1515341399,"genre":"Action","country":"États-Unis","director":"James Wan","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/dCgm7efXDmiABSdWDHBDBx2jwmn.jpg"},
      {"year":2015,"rank":4,"title":"Avengers: Age of Ultron","boxOffice":1402809540,"genre":"Action / Super-héros","country":"États-Unis","director":"Joss Whedon","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/4ssDuvEDkSArWEdyBl2X5EHvYKU.jpg"},
      {"year":2015,"rank":5,"title":"Minions","boxOffice":1159444662,"genre":"Animation","country":"États-Unis","director":"Pierre Coffin, Kyle Balda","directorGender":"Hommes","poster":"https://image.tmdb.org/t/p/w500/dr02BdCNAUPVU07aOodwPYv6HCf.jpg"},
      {"year":2016,"rank":1,"title":"Captain America: Civil War","boxOffice":1153337496,"genre":"Action / Super-héros","country":"États-Unis","director":"Anthony & Joe Russo","directorGender":"Hommes","poster":"https://image.tmdb.org/t/p/w500/rAGiXaUfPu0D2BJ1JMQzJiD8tFl.jpg"},
      {"year":2016,"rank":2,"title":"Rogue One: A Star Wars Story","boxOffice":1056057273,"genre":"Science-fiction","country":"États-Unis","director":"Gareth Edwards","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/i0yw1mFbB7sNGHCs7EXZPzFkdA1.jpg"},
      {"year":2016,"rank":3,"title":"Finding Dory","boxOffice":1028570889,"genre":"Animation","country":"États-Unis","director":"Andrew Stanton","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/yFjVlsJmEMacU0BNUwdGZlo2ixq.jpg"},
      {"year":2016,"rank":4,"title":"Zootopia","boxOffice":1025521689,"genre":"Animation","country":"États-Unis","director":"Byron Howard, Rich Moore","directorGender":"Hommes","poster":"https://image.tmdb.org/t/p/w500/hlK0e0wAQ3VLuJcsfIYPvb4JVud.jpg"},
      {"year":2016,"rank":5,"title":"The Jungle Book","boxOffice":967724775,"genre":"Aventure / Fantasy","country":"États-Unis","director":"Jon Favreau","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/vOipe2myi26UDwP978hsYOrnUWC.jpg"},
      {"year":2017,"rank":1,"title":"Star Wars: The Last Jedi","boxOffice":1334407706,"genre":"Science-fiction","country":"États-Unis","director":"Rian Johnson","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/kOVEVeg59E0wsnXmF9nrh6OmWII.jpg"},
      {"year":2017,"rank":2,"title":"Beauty and the Beast","boxOffice":1266115964,"genre":"Fantasy","country":"États-Unis","director":"Bill Condon","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/hKegSKIDep2ewJWPUQD7u0KqFIp.jpg"},
      {"year":2017,"rank":3,"title":"The Fate of the Furious","boxOffice":1236005118,"genre":"Action","country":"États-Unis","director":"F. Gary Gray","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/dImWM7GJqryWJO9LHa3XQ8DD5NH.jpg"},
      {"year":2017,"rank":4,"title":"Despicable Me 3","boxOffice":1034800131,"genre":"Animation","country":"États-Unis","director":"Kyle Balda","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/6t3YWl7hrr88lCEFlGVqW5yV99R.jpg"},
      {"year":2017,"rank":5,"title":"Jumanji: Welcome to the Jungle","boxOffice":962102237,"genre":"Aventure","country":"États-Unis","director":"Jake Kasdan","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/bXrZ5iHBEjH7WMidbUDQ0U2xbmr.jpg"},
      {"year":2018,"rank":1,"title":"Avengers: Infinity War","boxOffice":2048359754,"genre":"Action / Super-héros","country":"États-Unis","director":"Anthony & Joe Russo","directorGender":"Hommes","poster":"https://image.tmdb.org/t/p/w500/7WsyChQLEftFiDOVTGkv3hFpyyt.jpg"},
      {"year":2018,"rank":2,"title":"Black Panther","boxOffice":1347597973,"genre":"Action / Super-héros","country":"États-Unis","director":"Ryan Coogler","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/uxzzxijgPIY7slzFvMotPv8wjKA.jpg"},
      {"year":2018,"rank":3,"title":"Jurassic World: Fallen Kingdom","boxOffice":1308467944,"genre":"Science-fiction","country":"États-Unis","director":"J. A. Bayona","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/c9XxwwhPHdaImA2f1WEfEsbhaFB.jpg"},
      {"year":2018,"rank":4,"title":"Incredibles 2","boxOffice":1242805359,"genre":"Animation","country":"États-Unis","director":"Brad Bird","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/9lFKBtaVIhP7E2Pk0IY1CwTKTMZ.jpg"},
      {"year":2018,"rank":5,"title":"Aquaman","boxOffice":1148528393,"genre":"Action / Super-héros","country":"États-Unis","director":"James Wan","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/5Kg76ldv7VxeX9YlcQXiowHgdX6.jpg"},
      {"year":2019,"rank":1,"title":"Avengers: Endgame","boxOffice":2797501328,"genre":"Action / Super-héros","country":"États-Unis","director":"Anthony & Joe Russo","directorGender":"Hommes","poster":"https://image.tmdb.org/t/p/w500/or06FN3Dka5tukK1e9sl16pB3iy.jpg"},
      {"year":2019,"rank":2,"title":"The Lion King","boxOffice":1656943394,"genre":"Animation","country":"États-Unis","director":"Jon Favreau","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/dzBtMocZuJbjLOXvrl4zGYigDzh.jpg"},
      {"year":2019,"rank":3,"title":"Frozen II","boxOffice":1450026933,"genre":"Animation","country":"États-Unis","director":"Chris Buck, Jennifer Lee","directorGender":"Homme / Femme","poster":"https://image.tmdb.org/t/p/w500/xJWPZIYOEFIjZpBL7SVBGnzRYXp.jpg"},
      {"year":2019,"rank":4,"title":"Spider-Man: Far From Home","boxOffice":1131927996,"genre":"Action / Super-héros","country":"États-Unis","director":"Jon Watts","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/4q2NNj4S5dG2RLF9CpXsej7yXl.jpg"},
      {"year":2019,"rank":5,"title":"Captain Marvel","boxOffice":1128462972,"genre":"Action / Super-héros","country":"États-Unis","director":"Anna Boden, Ryan Fleck","directorGender":"Femme / Homme","poster":"https://image.tmdb.org/t/p/w500/AtsgWhDnHTq68L0lLsUrCnM7TjG.jpg"},
      {"year":2020,"rank":1,"title":"The Eight Hundred","boxOffice":461421559,"genre":"Guerre","country":"Chine","director":"Guan Hu","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/pk4GFAALvJhckzPY5h3L1RkfSD6.jpg"},
      {"year":2020,"rank":2,"title":"Bad Boys for Life","boxOffice":426505244,"genre":"Action","country":"États-Unis","director":"Adil El Arbi, Bilall Fallah","directorGender":"Hommes","poster":"https://image.tmdb.org/t/p/w500/y95lQLnuNKdPAzw9F9Ab8kJ80c3.jpg"},
      {"year":2021,"rank":1,"title":"Spider-Man: No Way Home","boxOffice":1921847111,"genre":"Action / Super-héros","country":"États-Unis","director":"Jon Watts","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/1g0dhYtq4irTY1GPXvft6k4YLjm.jpg"},
      {"year":2022,"rank":1,"title":"Avatar: The Way of Water","boxOffice":2320250281,"genre":"Science-fiction","country":"États-Unis","director":"James Cameron","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/t6HIqrRAclMCA60NsSmeqe9RmNV.jpg"},
      {"year":2023,"rank":1,"title":"Barbie","boxOffice":1445638421,"genre":"Comédie / Fantasy","country":"États-Unis","director":"Greta Gerwig","directorGender":"Femme","poster":"https://image.tmdb.org/t/p/w500/iuFNMS8U5cb6xfzi51Dbkovj7vM.jpg"},
      {"year":2023,"rank":2,"title":"The Super Mario Bros. Movie","boxOffice":1361992475,"genre":"Animation","country":"États-Unis","director":"Aaron Horvath, Michael Jelenic","directorGender":"Hommes","poster":"https://image.tmdb.org/t/p/w500/qNBAXBIQlnOThrVvA6mA2B5ggV6.jpg"},
      {"year":2023,"rank":3,"title":"Oppenheimer","boxOffice":975440031,"genre":"Drame historique","country":"États-Unis","director":"Christopher Nolan","directorGender":"Homme","poster":"https://image.tmdb.org/t/p/w500/8Gxv8gSFCU0XGDykEGv7zR1n2ua.jpg"}
      // ... Données simplifiées pour l'exemple, le code complet utilise la liste entière
    ];

    const slider = document.getElementById("boxoffice-slider");
    const yearDisplay = document.getElementById("boxoffice-year");
    const panel = document.getElementById("boxoffice-films");
    const searchInput = document.getElementById("movie-search");

    let currentChart;

    function formatBoxOffice(value) {
      return '$' + (value / 1000000).toFixed(1) + 'M';
    }

    // --- Graphique Interactif ---
    function initChart() {
      const ctx = document.getElementById('topChart').getContext('2d');
      const topOnes = data.filter(f => f.rank === 1).sort((a,b) => a.year - b.year);
      
      currentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: topOnes.map(f => f.year),
          datasets: [{
            label: 'Revenu du N°1 (en Millions $)',
            data: topOnes.map(f => f.boxOffice / 1000000),
            borderColor: '#f7c873',
            backgroundColor: 'rgba(247, 200, 115, 0.2)',
            fill: true,
            tension: 0.4,
            pointRadius: 6,
            pointHoverRadius: 10
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: {
            y: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#f7c873'} },
            x: { grid: { display: false }, ticks: { color: '#f7c873'} }
          }
        }
      });
    }

    // --- Filtrage & Affichage ---
    function renderFilms() {
      const year = slider.value;
      const term = searchInput.value.toLowerCase();
      yearDisplay.textContent = year;
      panel.innerHTML = "";

      const filtered = data.filter(f => {
        const matchesYear = f.year == year;
        const matchesSearch = f.title.toLowerCase().includes(term) || 
                              f.director.toLowerCase().includes(term) || 
                              f.genre.toLowerCase().includes(term);
        return term ? matchesSearch : matchesYear;
      });

      if (filtered.length === 0) {
        panel.innerHTML = "<p style='text-align:center'>Aucun film trouvé...</p>";
        return;
      }

      filtered.forEach(film => {
        panel.innerHTML += `
          <div class="film">
            <div class="poster" style="background-image:url('${film.poster}')"></div>
            <div class="info">
              <div class="film-title">#${film.rank} ${film.title} (${film.year})</div>
              <div class="meta"><b>Réalisateur:</b> ${film.director}</div>
              <div class="meta"><b>Genre:</b> ${film.genre} | <b>Box-Office:</b> ${formatBoxOffice(film.boxOffice)}</div>
            </div>
            <div class="hover-details">
               <div><b>Pays:</b> ${film.country}</div>
               <div><b>Sexe Réal:</b> ${film.directorGender}</div>
               <div><b>Précis:</b> $${film.boxOffice.toLocaleString()}</div>
            </div>
          </div>
        `;
      });
    }

    // --- Export PDF ---
    window.exportPDF = async function() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'mm', 'a4');
      const element = document.body;

      // On capture les parties importantes
      const canvas = await html2canvas(element);
      const imgData = canvas.toDataURL('image/png');
      
      doc.setFont("helvetica", "bold");
      doc.text("Rapport Marché Cinéma (2013-2023)", 10, 10);
      doc.addImage(imgData, 'PNG', 0, 20, 210, 150); // Ajusté à la page
      doc.save(`Analyse_Cinema_${new Date().getTime()}.pdf`);
    };

    // Events
    slider.addEventListener("input", renderFilms);
    searchInput.addEventListener("input", renderFilms);
    
    // Init
    initChart();
    renderFilms();

  })();
</script>
</body>
</html>
