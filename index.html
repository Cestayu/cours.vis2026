<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Cinema Royale - Data Visualisation</title>
<link href="https://fonts.googleapis.com/css2?family=Limelight&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
  :root {
    --gold: #f7c873;
    --gold-shadow: rgba(247, 200, 115, 0.5);
    --covid-color: rgba(255, 69, 58, 0.25);
    --bg-dark: #0a0a0a;
  }

  body {
    margin: 0;
    min-height: 100vh;
    background: var(--bg-dark);
    color: #f5d76e;
    font-family: 'Segoe UI', sans-serif;
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    transition: background-image 1s ease;
  }

  body::before {
    content: "";
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: radial-gradient(circle at center, rgba(0,0,0,0.7) 0%, #000 100%);
    z-index: 0;
  }

  h1 {
    margin-top: 30px;
    font-family: 'Limelight', cursive;
    font-size: 70px;
    color: var(--gold);
    text-shadow: 0 0 20px var(--gold-shadow);
    z-index: 2;
    margin-bottom: 10px;
  }

  /* --- Barre de Recherche & Filtres --- */
  .search-container {
    z-index: 2;
    width: 90%;
    max-width: 1000px;
    margin-bottom: 20px;
    text-align: center;
  }

  #search-bar {
    width: 100%;
    padding: 15px 25px;
    border-radius: 50px;
    border: 1px solid var(--gold);
    background: rgba(0,0,0,0.6);
    color: white;
    font-size: 18px;
    outline: none;
    backdrop-filter: blur(5px);
    transition: box-shadow 0.3s;
  }

  #search-bar:focus {
    box-shadow: 0 0 15px var(--gold-shadow);
  }

  /* --- Dashboard --- */
  #boxoffice-viz {
    position: relative;
    width: 90%;
    max-width: 1000px;
    background: rgba(0,0,0,0.85);
    border: 1px solid rgba(255, 215, 120, 0.2);
    border-radius: 20px;
    padding: 30px;
    z-index: 2;
    backdrop-filter: blur(10px);
    margin-bottom: 50px;
  }

  .controls-row {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 30px;
  }

  .year-display { font-family: 'Limelight', cursive; font-size: 48px; color: var(--gold); min-width: 120px; }
  input[type=range] { flex: 1; accent-color: var(--gold); cursor: pointer; }

  .btn-stats {
    background: transparent;
    border: 2px solid var(--gold);
    color: var(--gold);
    padding: 12px 20px;
    font-family: 'Limelight', cursive;
    cursor: pointer;
    border-radius: 5px;
    transition: all 0.3s;
  }
  .btn-stats:hover { background: var(--gold); color: #000; }

  .films-panel { display: grid; gap: 15px; }

  .film {
    display: flex; align-items: center; padding: 15px;
    border: 1px solid rgba(255, 215, 120, 0.1);
    border-radius: 15px; background: rgba(255,255,255,0.03);
    transition: transform 0.3s;
    animation: fadeIn 0.5s ease forwards;
  }
  .film:hover { transform: scale(1.01); border-color: var(--gold); }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  .poster { width: 90px; height: 130px; border-radius: 8px; background-size: cover; flex-shrink: 0; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
  .info { margin-left: 20px; flex: 1; }
  .film-title { font-family: 'Limelight', cursive; font-size: 22px; color: var(--gold); margin-bottom: 5px; }
  .meta { font-size: 14px; color: #ccc; margin-bottom: 5px; }
  .box-office-amount { font-weight: bold; color: #fff; font-size: 18px; }

  /* --- Graphique Overlay --- */
  #chart-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.98);
    z-index: 100; display: none; flex-direction: column; align-items: center; justify-content: center;
  }

  .chart-card {
    width: 90%; max-width: 900px; background: #111; padding: 30px; border-radius: 15px;
    border: 1px solid var(--gold); position: relative;
  }

  #chart-svg { width: 100%; height: 400px; }

  .path-anim {
    stroke-dasharray: 2000;
    stroke-dashoffset: 2000;
    animation: draw 3s forwards ease-in-out;
  }

  @keyframes draw { to { stroke-dashoffset: 0; } }

  .btn-export {
    margin-top: 20px;
    background: #27ae60;
    color: white;
    border: none;
    padding: 10px 25px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
  }

  .close-btn { position: absolute; top: 20px; right: 30px; font-size: 40px; cursor: pointer; color: var(--gold); }
</style>
</head>

<body>
  <div class="lamp left"></div>
  <div class="lamp right"></div>
  
  <h1>Cinema</h1>

  <div class="search-container">
    <input type="text" id="search-bar" placeholder="Rechercher un film, un rÃ©alisateur, un genre ou un pays...">
  </div>

  <section id="boxoffice-viz">
    <div class="controls-row">
      <div class="year-display" id="boxoffice-year">2013</div>
      <input type="range" min="2013" max="2023" step="1" value="2013" id="boxoffice-slider">
      <button class="btn-stats" onclick="toggleChart(true)">ðŸ“Š ANALYSE</button>
    </div>
    <div class="films-panel" id="boxoffice-films"></div>
  </section>

  <div id="chart-overlay">
    <span class="close-btn" onclick="toggleChart(false)">&times;</span>
    <div class="chart-card" id="pdf-content">
      <h2 style="font-family: 'Limelight'; color: var(--gold); text-align: center;">Ã‰volution du Box-Office Mondial (NÂ°1)</h2>
      <svg id="chart-svg" viewBox="0 0 800 400"></svg>
      <div style="display: flex; justify-content: space-around; color: #999; font-size: 12px; margin-top: 10px;">
        <span>2013</span><span>2015</span><span>2017</span><span>2019</span><span>2021</span><span>2023</span>
      </div>
    </div>
    <button class="btn-export" onclick="exportPDF()">ðŸ“¥ TÃ©lÃ©charger l'Analyse PDF</button>
  </div>

<script>
  (function () {
    const data = [
      {"year":2013,"rank":1,"title":"Frozen","boxOffice":1280802282,"genre":"Animation","country":"Ã‰tats-Unis","director":"Chris Buck, Jennifer Lee","poster":"https://image.tmdb.org/t/p/w500/kgwjIb1CkFCftymFGOtdLlOrWYv.jpg"},
      {"year":2013,"rank":2,"title":"Iron Man 3","boxOffice":1214811252,"genre":"Action","country":"Ã‰tats-Unis","director":"Shane Black","poster":"https://image.tmdb.org/t/p/w500/qhPtAc1TKbMPqNvcdXSOn9Bn7hZ.jpg"},
      {"year":2013,"rank":3,"title":"Despicable Me 2","boxOffice":970766005,"genre":"Animation","country":"Ã‰tats-Unis","director":"Pierre Coffin","poster":"https://image.tmdb.org/t/p/w500/5Fh4NdoEnCjCK9wLjdJ9DJNFl2b.jpg"},
      {"year":2014,"rank":1,"title":"Transformers 4","boxOffice":1104054072,"genre":"Science-fiction","country":"Ã‰tats-Unis","director":"Michael Bay","poster":"https://image.tmdb.org/t/p/w500/jyzrfx2WaeY60kYZpPYepSjGz4S.jpg"},
      {"year":2015,"rank":1,"title":"Star Wars: Force Awakens","boxOffice":2068223624,"genre":"Science-fiction","country":"Ã‰tats-Unis","director":"J.J. Abrams","poster":"https://image.tmdb.org/t/p/w500/wqnLdwVXoBjKibFRR5U3y0aDUhs.jpg"},
      {"year":2016,"rank":1,"title":"Captain America: Civil War","boxOffice":1153337496,"genre":"Action","country":"Ã‰tats-Unis","director":"Russo Brothers","poster":"https://image.tmdb.org/t/p/w500/rAGiXaUfPu0D2BJ1JMQzJiD8tFl.jpg"},
      {"year":2017,"rank":1,"title":"Star Wars: Last Jedi","boxOffice":1334407706,"genre":"Science-fiction","country":"Ã‰tats-Unis","director":"Rian Johnson","poster":"https://image.tmdb.org/t/p/w500/kOVEVeg59E0wsnXmF9nrh6OmWII.jpg"},
      {"year":2018,"rank":1,"title":"Avengers: Infinity War","boxOffice":2048359754,"genre":"Action","country":"Ã‰tats-Unis","director":"Russo Brothers","poster":"https://image.tmdb.org/t/p/w500/7WsyChQLEftFiDOVTGkv3hFpyyt.jpg"},
      {"year":2019,"rank":1,"title":"Avengers: Endgame","boxOffice":2797501328,"genre":"Action","country":"Ã‰tats-Unis","director":"Russo Brothers","poster":"https://image.tmdb.org/t/p/w500/or06FN3Dka5tukK1e9sl16pB3iy.jpg"},
      {"year":2020,"rank":1,"title":"The Eight Hundred","boxOffice":461421559,"genre":"Guerre","country":"Chine","director":"Guan Hu","poster":"https://image.tmdb.org/t/p/w500/pk4GFAALvJhckzPY5h3L1RkfSD6.jpg"},
      {"year":2021,"rank":1,"title":"Spider-Man: No Way Home","boxOffice":1921847111,"genre":"Action","country":"Ã‰tats-Unis","director":"Jon Watts","poster":"https://image.tmdb.org/t/p/w500/1g0dhYtq4irTY1GPXvft6k4YLjm.jpg"},
      {"year":2022,"rank":1,"title":"Avatar: Way of Water","boxOffice":2320250281,"genre":"Science-fiction","country":"Ã‰tats-Unis","director":"James Cameron","poster":"https://image.tmdb.org/t/p/w500/t6HIqrRAclMCA60NsSmeqe9RmNV.jpg"},
      {"year":2023,"rank":1,"title":"Barbie","boxOffice":1445638421,"genre":"ComÃ©die","country":"Ã‰tats-Unis","director":"Greta Gerwig","poster":"https://image.tmdb.org/t/p/w500/iuFNMS8U5cb6xfzi51Dbkovj7vM.jpg"}
    ];

    const slider = document.getElementById("boxoffice-slider");
    const yearDisplay = document.getElementById("boxoffice-year");
    const searchBar = document.getElementById("search-bar");
    const panel = document.getElementById("boxoffice-films");

    function updateView() {
      const year = slider.value;
      const query = searchBar.value.toLowerCase();
      yearDisplay.textContent = year;
      panel.innerHTML = "";

      const filtered = data.filter(f => {
        const matchesSearch = f.title.toLowerCase().includes(query) || 
                              f.director.toLowerCase().includes(query) || 
                              f.genre.toLowerCase().includes(query) ||
                              f.country.toLowerCase().includes(query);
        return f.year == year && matchesSearch;
      });

      if (filtered.length > 0) {
        document.body.style.backgroundImage = `url('${filtered[0].poster}')`;
      }

      filtered.forEach((f, i) => {
        panel.innerHTML += `
          <div class="film" style="animation-delay: ${i*0.1}s">
            <div class="poster" style="background-image:url('${f.poster}')"></div>
            <div class="info">
              <div class="film-title">#${f.rank} ${f.title}</div>
              <div class="meta">${f.genre} | Dir: ${f.director} | ${f.country}</div>
              <div class="box-office-amount">$${f.boxOffice.toLocaleString('fr-FR')}</div>
            </div>
          </div>
        `;
      });
    }

    // --- Graphique AnimÃ© ---
    window.toggleChart = function(show) {
      document.getElementById('chart-overlay').style.display = show ? 'flex' : 'none';
      if(show) drawAnimatedChart();
    }

    function drawAnimatedChart() {
      const svg = document.getElementById('chart-svg');
      svg.innerHTML = '';
      const topOnes = data.filter(d => d.rank === 1).sort((a,b) => a.year - b.year);
      const maxBO = 3000000000;
      const w = 800, h = 400, pad = 50;

      // Zone Covid
      const x2020 = pad + (2020-2013)*(w-2*pad)/10;
      const x2021 = pad + (2021-2013)*(w-2*pad)/10;
      svg.innerHTML += `<rect x="${x2020}" y="${pad}" width="${x2021-x2020}" height="${h-2*pad}" fill="var(--covid-color)" />`;

      let points = "";
      topOnes.forEach((d, i) => {
        const x = pad + (d.year - 2013) * (w - 2 * pad) / 10;
        const y = h - pad - (d.boxOffice / maxBO) * (h - 2 * pad);
        points += `${x},${y} `;
        svg.innerHTML += `<circle cx="${x}" cy="${y}" r="6" fill="var(--gold)" />`;
      });

      const polyline = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
      polyline.setAttribute("points", points);
      polyline.setAttribute("fill", "none");
      polyline.setAttribute("stroke", "var(--gold)");
      polyline.setAttribute("stroke-width", "4");
      polyline.setAttribute("class", "path-anim");
      svg.appendChild(polyline);
    }

    // --- Export PDF ---
    window.exportPDF = async function() {
      const { jsPDF } = window.jspdf;
      const content = document.getElementById('pdf-content');
      const canvas = await html2canvas(content, { backgroundColor: '#111' });
      const imgData = canvas.toDataURL('image/png');
      const pdf = new jsPDF('l', 'mm', 'a4');
      pdf.setTextColor(247, 200, 115);
      pdf.text("Rapport Annuel Cinema Royale", 10, 10);
      pdf.addImage(imgData, 'PNG', 15, 30, 260, 130);
      pdf.save(`Analyse_Cinema_2013_2023.pdf`);
    }

    slider.addEventListener("input", updateView);
    searchBar.addEventListener("input", updateView);
    updateView();
  })();
</script>
</body>
</html>
