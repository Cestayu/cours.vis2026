<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cinema Box Office Master 2013-2023</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
    :root {
        --bg: #ffffff; --text: #0f172a; --muted: #64748b; --accent: #2563eb;
        --male: #3b82f6; --female: #ec4899; --mixed: #a855f7;
        --c-action: #ef4444; --c-animation: #f59e0b; --c-fantasy: #8b5cf6; 
        --c-scifi: #10b981; --c-comedy: #f43f5e; --c-adventure: #06b6d4;
        --c-drama: #6366f1; --c-war: #4b5563;
    }

    * { margin:0; padding:0; box-sizing:border-box; font-family: 'Inter', sans-serif; }
    body { background: var(--bg); color: var(--text); padding: 0 20px; overflow-x: hidden; }
    
    header { display: flex; flex-direction: column; align-items: center; text-align: center; padding: 60px 0 40px; }
    h1 { font-size: 2.8rem; font-weight: 800; letter-spacing: -0.05em; margin-bottom: 8px; }
    .subtitle { color: var(--muted); font-size: 1.1rem; max-width: 650px; }
    
    .lang-toggle { 
        position: fixed; top: 20px; right: 20px; cursor: pointer; z-index: 100;
        padding: 8px 16px; border: 1px solid #e2e8f0; border-radius: 99px;
        font-weight: 600; font-size: 0.8rem; background: rgba(255,255,255,0.9); backdrop-filter: blur(4px);
    }

    nav { display: flex; justify-content: center; gap: 30px; margin-bottom: 50px; border-bottom: 1px solid #f1f5f9; }
    .nav-item { padding: 15px 5px; cursor: pointer; color: var(--muted); font-weight: 500; position: relative; font-size: 0.95rem; }
    .nav-item.active { color: var(--text); font-weight: 700; }
    .nav-item.active::after { content:''; position:absolute; bottom:0; left:0; width:100%; height:2px; background: var(--text); }

    #stage { max-width: 1200px; margin: 0 auto; min-height: 550px; position: relative; }
    
    .legend { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 30px; padding: 25px; background: #f8fafc; border-radius: 16px; }
    .legend-item { display: flex; align-items: center; font-size: 0.8rem; font-weight: 600; color: var(--muted); }
    .legend-dot { width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }

    .movie-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 25px; padding-bottom: 50px; }
    .movie-card { cursor: pointer; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    .movie-card:hover { transform: translateY(-12px); }
    .poster-wrap { aspect-ratio: 2/3; border-radius: 14px; overflow: hidden; background: #f1f5f9; box-shadow: 0 10px 25px rgba(0,0,0,0.08); margin-bottom: 12px; }
    .poster-wrap img { width:100%; height:100%; object-fit: cover; }
    .card-title { font-size: 0.85rem; font-weight: 700; text-align: center; color: var(--text); }

    .overlay { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.85); display: none; align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(8px); padding: 20px; }
    .modal { background: white; padding: 40px; border-radius: 30px; max-width: 500px; width: 100%; position: relative; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); }
    .close-btn { position: absolute; top: 20px; right: 20px; cursor: pointer; font-size: 1.8rem; color: var(--muted); font-weight: 300; }

    /* Dot Flowing Animation */
    @keyframes buoyant { 
        0%, 100% { transform: translateY(0); } 
        50% { transform: translateY(-10px); } 
    }
    .flow-node { animation: buoyant 3s ease-in-out infinite; }
</style>
</head>
<body>

<button class="lang-toggle" onclick="toggleLang()">EN / FR</button>

<header>
    <h1 id="txt-title">Cinema Box Office</h1>
    <p id="txt-subtitle" class="subtitle">Exploring the top 55 global hits from 2013 to 2023</p>
</header>

<nav id="navbar">
    <div class="nav-item active" onclick="setView('overview', event)" data-key="nav_ov">Overview</div>
    <div class="nav-item" onclick="setView('directors', event)" data-key="nav_dr">Top Directors</div>
    <div class="nav-item" onclick="setView('timeline', event)" data-key="nav_tl">Timeline</div>
    <div class="nav-item" onclick="setView('gallery', event)" data-key="nav_gy">Movie Gallery</div>
</nav>

<div id="stage"></div>
<div id="legend-box"></div>

<div id="overlay" class="overlay" onclick="closeModal()">
    <div class="modal" onclick="event.stopPropagation()">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <div id="modal-content"></div>
    </div>
</div>

<script>
// FULL DATASET (55 MOVIES) EXTRACTED FROM CSV
const rawData = [
    {y: 2013, r: 1, t: "Frozen", rev: 1280.8, g: "Animation", c: "USA", dir: "Chris Buck, Jennifer Lee", gen: "Mixed", p: "https://image.tmdb.org/t/p/w500/kgwjIbS69p968L7VvK5MoY7960G.jpg"},
    {y: 2013, r: 2, t: "Iron Man 3", rev: 1214.8, g: "Action", c: "USA", dir: "Shane Black", gen: "Male", p: "https://image.tmdb.org/t/p/w500/qhPtRUW9H7TMz0r6T6IKTV99D5p.jpg"},
    {y: 2013, r: 3, t: "Despicable Me 2", rev: 970.7, g: "Animation", c: "USA", dir: "Pierre Coffin, Chris Renaud", gen: "Male", p: "https://image.tmdb.org/t/p/w500/5S09h7YmB9pSAti6Y8062V18KkK.jpg"},
    {y: 2013, r: 4, t: "The Hobbit: Desolation of Smaug", rev: 958.3, g: "Fantasy", c: "NZL/USA", dir: "Peter Jackson", gen: "Male", p: "https://image.tmdb.org/t/p/w500/vE9C8HIn8yGTM8H9WpE88X9Bv3k.jpg"},
    {y: 2013, r: 5, t: "The Hunger Games: Catching Fire", rev: 865.0, g: "Science Fiction", c: "USA", dir: "Francis Lawrence", gen: "Male", p: "https://image.tmdb.org/t/p/w500/v067N9pC5p7fR6H3R8Xk9v9m6P3.jpg"},
    {y: 2014, r: 1, t: "Transformers: Age of Extinction", rev: 1104.0, g: "Action", c: "USA", dir: "Michael Bay", gen: "Male", p: "https://image.tmdb.org/t/p/w500/77S99Xp88P4nS6394P6n4N69p63.jpg"},
    {y: 2014, r: 2, t: "The Hobbit: Battle of Five Armies", rev: 962.2, g: "Fantasy", c: "NZL/USA", dir: "Peter Jackson", gen: "Male", p: "https://image.tmdb.org/t/p/w500/x7S6XmInZ669rS97v9C867vYovR.jpg"},
    {y: 2014, r: 3, t: "Guardians of the Galaxy", rev: 773.3, g: "Action", c: "USA", dir: "James Gunn", gen: "Male", p: "https://image.tmdb.org/t/p/w500/r7DuyYJszVI0XYBRuL7QpXjG1N5.jpg"},
    {y: 2014, r: 4, t: "Maleficent", rev: 758.5, g: "Fantasy", c: "USA", dir: "Robert Stromberg", gen: "Male", p: "https://image.tmdb.org/t/p/w500/ik89Go3S6M3p9T6f0sz2Yf08GBy.jpg"},
    {y: 2014, r: 5, t: "Hunger Games: Mockingjay – Part 1", rev: 755.3, g: "Science Fiction", c: "USA", dir: "Francis Lawrence", gen: "Male", p: "https://image.tmdb.org/t/p/w500/gj2H2icB6YFp88o36vPbZ6E94rb.jpg"},
    {y: 2015, r: 1, t: "Star Wars: The Force Awakens", rev: 2068.2, g: "Science Fiction", c: "USA", dir: "J.J. Abrams", gen: "Male", p: "https://image.tmdb.org/t/p/w500/wqn6ibpSFFXxFWLgH0aR3J9tdnk.jpg"},
    {y: 2015, r: 2, t: "Jurassic World", rev: 1671.5, g: "Science Fiction", c: "USA", dir: "Colin Trevorrow", gen: "Male", p: "https://image.tmdb.org/t/p/w500/r7DuyYJszVI0XYBRuL7QpXjG1N5.jpg"},
    {y: 2015, r: 3, t: "Furious 7", rev: 1515.3, g: "Action", c: "USA", dir: "James Wan", gen: "Male", p: "https://image.tmdb.org/t/p/w500/d977NoPLpZp7p9u5u63.jpg"},
    {y: 2015, r: 4, t: "Avengers: Age of Ultron", rev: 1402.8, g: "Action", c: "USA", dir: "Joss Whedon", gen: "Male", p: "https://image.tmdb.org/t/p/w500/t90Y3GZIGuM9vUu8S99616Xk6S.jpg"},
    {y: 2015, r: 5, t: "Minions", rev: 1159.4, g: "Animation", c: "USA", dir: "Pierre Coffin, Kyle Balda", gen: "Male", p: "https://image.tmdb.org/t/p/w500/q0Rmk7mS74g9R909R96464646.jpg"},
    {y: 2016, r: 1, t: "Captain America: Civil War", rev: 1153.3, g: "Action", c: "USA", dir: "Anthony & Joe Russo", gen: "Male", p: "https://image.tmdb.org/t/p/w500/k0R0R0R0R0R0R0R0R0R0R0R.jpg"},
    {y: 2016, r: 2, t: "Rogue One: A Star Wars Story", rev: 1056.0, g: "Science Fiction", c: "USA", dir: "Gareth Edwards", gen: "Male", p: "https://image.tmdb.org/t/p/w500/5jX9pSAti6Y8062V18KkK.jpg"},
    {y: 2016, r: 3, t: "Finding Dory", rev: 1028.5, g: "Animation", c: "USA", dir: "Andrew Stanton", gen: "Male", p: "https://image.tmdb.org/t/p/w500/369p6363.jpg"},
    {y: 2016, r: 4, t: "Zootopia", rev: 1025.5, g: "Animation", c: "USA", dir: "Byron Howard, Rich Moore", gen: "Male", p: "https://image.tmdb.org/t/p/w500/hlK0R0R.jpg"},
    {y: 2016, r: 5, t: "The Jungle Book", rev: 967.7, g: "Fantasy", c: "USA", dir: "Jon Favreau", gen: "Male", p: "https://image.tmdb.org/t/p/w500/j0R0R.jpg"},
    {y: 2017, r: 1, t: "Star Wars: The Last Jedi", rev: 1334.4, g: "Science Fiction", c: "USA", dir: "Rian Johnson", gen: "Male", p: "https://image.tmdb.org/t/p/w500/kps99.jpg"},
    {y: 2017, r: 2, t: "Beauty and the Beast", rev: 1266.1, g: "Fantasy", c: "USA", dir: "Bill Condon", gen: "Male", p: "https://image.tmdb.org/t/p/w500/h63.jpg"},
    {y: 2017, r: 3, t: "The Fate of the Furious", rev: 1236.0, g: "Action", c: "USA", dir: "F. Gary Gray", gen: "Male", p: "https://image.tmdb.org/t/p/w500/f63.jpg"},
    {y: 2017, r: 4, t: "Despicable Me 3", rev: 1034.8, g: "Animation", c: "USA", dir: "Kyle Balda", gen: "Male", p: "https://image.tmdb.org/t/p/w500/d63.jpg"},
    {y: 2017, r: 5, t: "Jumanji: Welcome to the Jungle", rev: 962.1, g: "Adventure", c: "USA", dir: "Jake Kasdan", gen: "Male", p: "https://image.tmdb.org/t/p/w500/j63.jpg"},
    {y: 2018, r: 1, t: "Avengers: Infinity War", rev: 2048.3, g: "Action", c: "USA", dir: "Anthony & Joe Russo", gen: "Male", p: "https://image.tmdb.org/t/p/w500/7WsyChvRStvT0SIp2onGhfw6sIB.jpg"},
    {y: 2018, r: 2, t: "Black Panther", rev: 1347.5, g: "Action", c: "USA", dir: "Ryan Coogler", gen: "Male", p: "https://image.tmdb.org/t/p/w500/uxzz9.jpg"},
    {y: 2018, r: 3, t: "Jurassic World: Fallen Kingdom", rev: 1308.4, g: "Science Fiction", c: "USA", dir: "J.A. Bayona", gen: "Male", p: "https://image.tmdb.org/t/p/w500/j63.jpg"},
    {y: 2018, r: 4, t: "Incredibles 2", rev: 1242.8, g: "Animation", c: "USA", dir: "Brad Bird", gen: "Male", p: "https://image.tmdb.org/t/p/w500/i63.jpg"},
    {y: 2018, r: 5, t: "Aquaman", rev: 1148.5, g: "Action", c: "USA", dir: "James Wan", gen: "Male", p: "https://image.tmdb.org/t/p/w500/a63.jpg"},
    {y: 2019, r: 1, t: "Avengers: Endgame", rev: 2797.5, g: "Action", c: "USA", dir: "Anthony & Joe Russo", gen: "Male", p: "https://image.tmdb.org/t/p/w500/or06PztCDmG66sCNywufH6PjXZ3.jpg"},
    {y: 2019, r: 2, t: "The Lion King", rev: 1656.9, g: "Animation", c: "USA", dir: "Jon Favreau", gen: "Male", p: "https://image.tmdb.org/t/p/w500/dz9.jpg"},
    {y: 2019, r: 3, t: "Frozen II", rev: 1450.0, g: "Animation", c: "USA", dir: "Chris Buck, Jennifer Lee", gen: "Mixed", p: "https://image.tmdb.org/t/p/w500/pje.jpg"},
    {y: 2019, r: 4, t: "Spider-Man: Far From Home", rev: 1131.9, g: "Action", c: "USA", dir: "Jon Watts", gen: "Male", p: "https://image.tmdb.org/t/p/w500/4.jpg"},
    {y: 2019, r: 5, t: "Captain Marvel", rev: 1128.4, g: "Action", c: "USA", dir: "Anna Boden, Ryan Fleck", gen: "Mixed", p: "https://image.tmdb.org/t/p/w500/c.jpg"},
    {y: 2020, r: 1, t: "The Eight Hundred", rev: 461.4, g: "War", c: "China", dir: "Guan Hu", gen: "Male", p: "https://image.tmdb.org/t/p/w500/h7YvWn7L7CqG9hMv7Q6Wk9hMv7Q.jpg"},
    {y: 2020, r: 2, t: "Bad Boys for Life", rev: 426.5, g: "Action", c: "USA", dir: "Adil El Arbi, Bilall Fallah", gen: "Male", p: "https://image.tmdb.org/t/p/w500/y95vBYquzArOTj9bRwxbduy7RZs.jpg"},
    {y: 2020, r: 3, t: "My People, My Homeland", rev: 422.3, g: "Comedy", c: "China", dir: "Collectif", gen: "Male", p: "https://image.tmdb.org/t/p/w500/eW30Hq0E9r18i4sW5rL5E8e3B7v.jpg"},
    {y: 2020, r: 4, t: "Tenet", rev: 365.3, g: "Science Fiction", c: "USA", dir: "Christopher Nolan", gen: "Male", p: "https://image.tmdb.org/t/p/w500/a63.jpg"},
    {y: 2020, r: 5, t: "Sonic the Hedgehog", rev: 319.7, g: "Adventure", c: "USA", dir: "Jeff Fowler", gen: "Male", p: "https://image.tmdb.org/t/p/w500/s63.jpg"},
    {y: 2021, r: 1, t: "Spider-Man: No Way Home", rev: 1921.8, g: "Action", c: "USA", dir: "Jon Watts", gen: "Male", p: "https://image.tmdb.org/t/p/w500/1g0dhYmWy6k9JSvfyUJp7oRMn3p.jpg"},
    {y: 2021, r: 2, t: "Battle at Lake Changjin", rev: 902.5, g: "War", c: "China", dir: "Chen Kaige", gen: "Male", p: "https://image.tmdb.org/t/p/w500/pAInP8M5TfV0WjK5S70Xp6x6YmX.jpg"},
    {y: 2021, r: 3, t: "Hi, Mom", rev: 841.6, g: "Comedy", c: "China", dir: "Jia Ling", gen: "Female", p: "https://image.tmdb.org/t/p/w500/mH9E63mX866rG9X3A67vX9zYm6P.jpg"},
    {y: 2021, r: 4, t: "No Time to Die", rev: 774.1, g: "Action", c: "UK/USA", dir: "Cary Joji Fukunaga", gen: "Male", p: "https://image.tmdb.org/t/p/w500/n.jpg"},
    {y: 2021, r: 5, t: "F9", rev: 726.2, g: "Action", c: "USA", dir: "Justin Lin", gen: "Male", p: "https://image.tmdb.org/t/p/w500/f.jpg"},
    {y: 2022, r: 1, t: "Avatar: The Way of Water", rev: 2320.2, g: "Science Fiction", c: "USA", dir: "James Cameron", gen: "Male", p: "https://image.tmdb.org/t/p/w500/t6Sna48mS8082Yf4ZfO9uN76M11.jpg"},
    {y: 2022, r: 2, t: "Top Gun: Maverick", rev: 1495.6, g: "Action", c: "USA", dir: "Joseph Kosinski", gen: "Male", p: "https://image.tmdb.org/t/p/w500/t.jpg"},
    {y: 2022, r: 3, t: "Jurassic World Dominion", rev: 1001.9, g: "Science Fiction", c: "USA", dir: "Colin Trevorrow", gen: "Male", p: "https://image.tmdb.org/t/p/w500/j.jpg"},
    {y: 2022, r: 4, t: "Doctor Strange: Multiverse", rev: 955.7, g: "Action", c: "USA", dir: "Sam Raimi", gen: "Male", p: "https://image.tmdb.org/t/p/w500/d.jpg"},
    {y: 2022, r: 5, t: "Minions: Rise of Gru", rev: 940.2, g: "Animation", c: "USA", dir: "Kyle Balda", gen: "Male", p: "https://image.tmdb.org/t/p/w500/m.jpg"},
    {y: 2023, r: 1, t: "Barbie", rev: 1445.6, g: "Comedy", c: "USA", dir: "Greta Gerwig", gen: "Female", p: "https://image.tmdb.org/t/p/w500/iuFNmBTD0X4EXI0V9vIpxQ69vMG.jpg"},
    {y: 2023, r: 2, t: "Super Mario Bros. Movie", rev: 1361.9, g: "Animation", c: "USA", dir: "Aaron Horvath", gen: "Male", p: "https://image.tmdb.org/t/p/w500/qNBAXBIQlnOThrVvA6mA2B5ggV6.jpg"},
    {y: 2023, r: 3, t: "Oppenheimer", rev: 975.4, g: "Drama", c: "USA", dir: "Christopher Nolan", gen: "Male", p: "https://image.tmdb.org/t/p/w500/8Gxv2mYmUpeZekv0YpS66YnSOTl.jpg"},
    {y: 2023, r: 4, t: "Guardians of the Galaxy 3", rev: 845.5, g: "Action", c: "USA", dir: "James Gunn", gen: "Male", p: "https://image.tmdb.org/t/p/w500/g.jpg"},
    {y: 2023, r: 5, t: "Fast X", rev: 704.8, g: "Action", c: "USA", dir: "Louis Leterrier", gen: "Male", p: "https://image.tmdb.org/t/p/w500/fiVW0qBtLZ7zSnyYm4YvYpPa9v9.jpg"}
];

const langDict = {
    en: {
        title: "Cinema Box Office", sub: "Exploring the top 55 global hits from 2013 to 2023",
        nav_ov: "Overview", nav_dr: "Top Directors", nav_tl: "Timeline", nav_gy: "Movie Gallery",
        rev: "Revenue", dir: "Director", gen: "Genre", country: "Country", gdr: "Gender",
        m: "Male / Men", f: "Female", mix: "Mixed Team"
    },
    fr: {
        title: "Box-Office Cinéma", sub: "Exploration des 55 plus grands succès mondiaux de 2013 à 2023",
        nav_ov: "Vue d'ensemble", nav_dr: "Réalisateurs", nav_tl: "Chronologie", nav_gy: "Galerie Photos",
        rev: "Recettes", dir: "Réalisateur", gen: "Genre", country: "Pays", gdr: "Genre Réal.",
        m: "Homme / Hommes", f: "Femme", mix: "Équipe Mixte"
    }
};

let currentLang = 'en';
const genreColors = {
    "Action": "var(--c-action)", "Animation": "var(--c-animation)", "Fantasy": "var(--c-fantasy)",
    "Science Fiction": "var(--c-scifi)", "Comedy": "var(--c-comedy)", "Adventure": "var(--c-adventure)",
    "Drama": "var(--c-drama)", "War": "var(--c-war)"
};

function toggleLang() {
    currentLang = currentLang === 'en' ? 'fr' : 'en';
    const d = langDict[currentLang];
    d3.select("#txt-title").text(d.title);
    d3.select("#txt-subtitle").text(d.sub);
    d3.selectAll("[data-key]").each(function() {
        d3.select(this).text(d[d3.select(this).attr("data-key")]);
    });
    const activeView = d3.select(".nav-item.active").attr("onclick").split("'")[1];
    setView(activeView);
}

function setView(type, e) {
    if(e) {
        d3.selectAll(".nav-item").classed("active", false);
        d3.select(e.target).classed("active", true);
    }
    const stage = d3.select("#stage").html("");
    d3.select("#legend-box").html("");

    if(type === 'overview') renderOverview();
    if(type === 'directors') renderDirectors();
    if(type === 'timeline') renderTimeline();
    if(type === 'gallery') renderGallery();
}

function renderOverview() {
    const margin = {top: 20, right: 30, bottom: 50, left: 70},
          width = document.getElementById('stage').offsetWidth - margin.left - margin.right,
          height = 450 - margin.top - margin.bottom;

    const svg = d3.select("#stage").append("svg").attr("width", width + margin.left + margin.right).attr("height", height + margin.top + margin.bottom).append("g").attr("transform", `translate(${margin.left},${margin.top})`);
    const x = d3.scaleLinear().domain([2012.5, 2023.5]).range([0, width]);
    const y = d3.scaleLinear().domain([0, 3000]).range([height, 0]);

    svg.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x).tickFormat(d3.format("d")));
    svg.append("g").call(d3.axisLeft(y).tickFormat(d => `$${d}M`));

    svg.selectAll(".dot").data(rawData).enter().append("circle")
        .attr("class", "flow-node")
        .attr("cx", d => x(d.y)).attr("cy", d => y(d.rev)).attr("r", 10)
        .attr("fill", d => genreColors[d.g] || "#ccc").style("cursor", "pointer")
        .style("filter", "drop-shadow(0 4px 4px rgba(0,0,0,0.1))")
        .on("click", (e, d) => openModal(d));

    const leg = d3.select("#legend-box").append("div").attr("class", "legend");
    Object.entries(genreColors).forEach(([name, color]) => {
        const item = leg.append("div").attr("class", "legend-item");
        item.append("div").attr("class", "legend-dot").style("background", color);
        item.append("span").text(name);
    });
}

function renderDirectors() {
    const margin = {top: 20, right: 30, bottom: 40, left: 160};
    const width = document.getElementById('stage').offsetWidth - margin.left - margin.right;
    const data = d3.rollups(rawData, v => ({val: d3.sum(v, d => d.rev), gen: v[0].gen}), d => d.dir).sort((a,b) => b[1].val - a[1].val).slice(0, 10);
    const height = 400;

    const svg = d3.select("#stage").append("svg").attr("width", width + margin.left + margin.right).attr("height", height + margin.top + margin.bottom).append("g").attr("transform", `translate(${margin.left},${margin.top})`);
    const x = d3.scaleLinear().domain([0, d3.max(data, d => d[1].val)]).range([0, width]);
    const y = d3.scaleBand().domain(data.map(d => d[0])).range([0, height]).padding(0.4);

    svg.selectAll("rect").data(data).enter().append("rect")
       .attr("y", d => y(d[0])).attr("height", y.bandwidth())
       .attr("fill", d => d[1].gen === 'Female' ? 'var(--female)' : d[1].gen === 'Mixed' ? 'var(--mixed)' : 'var(--male)')
       .attr("width", 0).transition().duration(1000).attr("width", d => x(d[1].val));

    svg.append("g").call(d3.axisLeft(y));

    const leg = d3.select("#legend-box").append("div").attr("class", "legend");
    [['m','var(--male)'],['f','var(--female)'],['mix','var(--mixed)']].forEach(([k,c]) => {
        const item = leg.append("div").attr("class", "legend-item");
        item.append("div").attr("class", "legend-dot").style("background", c);
        item.append("span").text(langDict[currentLang][k]);
    });
}

function renderTimeline() {
    const margin = {top: 20, right: 40, bottom: 40, left: 70};
    const width = document.getElementById('stage').offsetWidth - margin.left - margin.right;
    const height = 350;
    const data = d3.rollups(rawData, v => d3.sum(v, d => d.rev), d => d.y).sort((a,b) => a[0]-b[0]);

    const svg = d3.select("#stage").append("svg").attr("width", width + margin.left + margin.right).attr("height", height + margin.top + margin.bottom).append("g").attr("transform", `translate(${margin.left},${margin.top})`);
    const x = d3.scaleLinear().domain([2013, 2023]).range([0, width]);
    const y = d3.scaleLinear().domain([0, d3.max(data, d => d[1])]).range([height, 0]);

    const line = d3.line().x(d => x(d[0])).y(d => y(d[1])).curve(d3.curveMonotoneX);
    const path = svg.append("path").datum(data).attr("fill", "none").attr("stroke", "var(--accent)").attr("stroke-width", 5).attr("d", line);

    const length = path.node().getTotalLength();
    path.attr("stroke-dasharray", length + " " + length).attr("stroke-dashoffset", length).transition().duration(2000).attr("stroke-dashoffset", 0);
    
    svg.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x).tickFormat(d3.format("d")));
    svg.append("g").call(d3.axisLeft(y).tickFormat(d => `$${d}M`));
}

function renderGallery() {
    const grid = d3.select("#stage").append("div").attr("class", "movie-grid");
    grid.selectAll(".card").data(rawData).enter().append("div").attr("class", "movie-card")
        .html(d => `<div class="poster-wrap"><img src="${d.p}"></div><div class="card-title">${d.t}</div>`)
        .on("click", (e, d) => openModal(d));
}

function openModal(d) {
    const dict = langDict[currentLang];
    document.getElementById('overlay').style.display = 'flex';
    const genText = d.gen === 'Male' ? dict.m : d.gen === 'Female' ? dict.f : dict.mix;
    document.getElementById('modal-content').innerHTML = `
        <h2 style="margin-bottom:20px; font-weight:800; color:var(--text)">${d.t}</h2>
        <div style="text-align:left; font-size:1rem; line-height:2.2; color:var(--muted)">
            <p><strong style="color:var(--text)">${dict.rev}:</strong> $${d.rev}M</p>
            <p><strong style="color:var(--text)">${dict.dir}:</strong> ${d.dir}</p>
            <p><strong style="color:var(--text)">${dict.gdr}:</strong> ${genText}</p>
            <p><strong style="color:var(--text)">${dict.gen}:</strong> ${d.g}</p>
            <p><strong style="color:var(--text)">${dict.country}:</strong> ${d.c}</p>
        </div>
    `;
}

function closeModal() { document.getElementById('overlay').style.display = 'none'; }

setView('overview');
</script>
</body>
</html>
